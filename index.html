<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Graduation Projects</title>
  <style>
    :root {
      --navy:#1b2656;
      --gold:#d99f53;
      --bg:#f4f4f4;
      --text:#1b2656;
      --muted:#4a4a4a;
      --border:#ddd;
    }
    body {
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
    }
    header {
      background:var(--navy);
      color:#fff;
      padding:20px 16px;
      text-align:center;
    }
    header h2 {
      margin:0;
      color:var(--gold);
      font-size:26px;
    }
    #cards {
      max-width:1100px;
      margin:24px auto 60px;
      padding:0 16px;
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
      gap:16px;
    }
    .card {
      background:#fff;
      border:1px solid var(--border);
      border-left:6px solid var(--gold);
      border-radius:10px;
      padding:16px;
      box-shadow:0 2px 4px rgba(0,0,0,0.05);
      display:flex;
      flex-direction:column;
      gap:10px;
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .card:hover {
      transform:translateY(-2px);
      box-shadow:0 4px 8px rgba(0,0,0,0.1);
    }
    .title {
      font-weight:700;
      font-size:17px;
      line-height:1.3;
      color:var(--navy);
    }
    .meta {
      font-size:13px;
      color:var(--muted);
      line-height:1.5;
    }
    .chips {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .chip {
      border:1px solid var(--gold);
      background:rgba(217,159,83,0.1);
      border-radius:999px;
      padding:4px 8px;
      font-size:12px;
      color:var(--navy);
      font-weight:500;
    }
    details summary {
      cursor:pointer;
      color:var(--navy);
      font-weight:600;
    }
    details ul {
      margin:6px 0 0 18px;
      padding:0;
      list-style:disc;
      color:var(--muted);
      font-size:13px;
    }
    .btn {
      align-self:flex-start;
      text-decoration:none;
      background:var(--gold);
      color:var(--navy);
      padding:8px 12px;
      border-radius:8px;
      font-weight:700;
      font-size:14px;
      transition:background .15s ease;
    }
    .btn:hover {
      background:#e4b56f;
    }
  </style>
</head>
<body>
  <header><h2>Graduation Projects</h2></header>
  <div id="cards">Loading…</div>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSKR8WlO5h6KLBmfLFOTOt1-EbnumBTTcYUr8e_A5lqt2iR9KSryisQMow3NhEY-94GxgIKUqD0iSoH/pub?gid=1404700974&single=true&output=csv"; // use .../pub?output=csv

    (async ()=>{
      try{
        const res = await fetch(CSV_URL);
        const csv = await res.text();

        // Tiny CSV parser
        const rows=[]; let row=[], val="", inQ=false;
        for (let i=0;i<csv.length;i++){
          const c=csv[i], n=csv[i+1];
          if (c === '"' && inQ && n === '"'){ val+='"'; i++; }
          else if (c === '"'){ inQ=!inQ; }
          else if (c === ',' && !inQ){ row.push(val); val=""; }
          else if ((c === '\n' || c === '\r') && !inQ){
            if (val.length || row.length){ row.push(val); rows.push(row); row=[]; val=""; }
            if (c === '\r' && n === '\n') i++;
          } else { val+=c; }
        }
        if (val.length || row.length){ row.push(val); rows.push(row); }

        const cards=document.getElementById('cards');
        if (!rows.length){ cards.textContent="No data."; return; }

        const headers=rows[0].map(h=>h.trim());
        const data=rows.slice(1).map(r=>{
          const o={}; for(let i=0;i<headers.length;i++) o[headers[i]]=(r[i]||"").trim(); return o;
        });

        const splitMulti=s=>(s||"").split(/[,;\n]\s*/).map(x=>x.trim()).filter(Boolean);

        cards.innerHTML="";
        for (const d of data){
          const cats=splitMulti(d["Categories"]);
          const studs=splitMulti(d["Students"]);
          const sup=d["Uni Supervisor 1"]||"";
          const ext=d["External Collaborator"]||"";
          const links=splitMulti(d["Details"]);
          const hasURL=s=>/^https?:\/\//i.test(s);

          const card=document.createElement('article'); card.className='card';
          card.innerHTML=`
            <div class="title">${d["Project"]||"Untitled"}</div>
            <div class="meta"><strong>ID:</strong> ${d["Id"]||"—"}<br>
              <strong>Year:</strong> ${d["Year"]||"—"} · <strong>Credit:</strong> ${d["General-Credit"]||"—"}<br>
              <strong>Supervisor:</strong> ${sup||"—"}<br>
              ${ext?`<strong>Collaborator:</strong> ${ext}<br>`:''}
              ${d["Funding"]?`<strong>Funding:</strong> ${d["Funding"]}`:''}
            </div>
          `;
          if (cats.length){
            const chips=document.createElement('div'); chips.className='chips';
            cats.forEach(t=>{
              const c=document.createElement('span');
              c.className='chip'; c.textContent=t; chips.appendChild(c);
            });
            card.appendChild(chips);
          }

          if (studs.length){
            const details=document.createElement('details');
            const summary=document.createElement('summary');
            summary.textContent=`Students (${studs.length})`;
            details.appendChild(summary);
            const ul=document.createElement('ul');
            studs.forEach(s=>{
              const li=document.createElement('li'); li.textContent=s; ul.appendChild(li);
            });
            details.appendChild(ul);
            card.appendChild(details);
          }

          if (links.length){
            const div=document.createElement('div');
            links.forEach(x=>{
              if (!x) return;
              const a=document.createElement('a');
              a.className='btn';
              a.textContent=hasURL(x)?'Open':x;
              a.href=hasURL(x)?x:'#';
              if (hasURL(x)){a.target='_blank';a.rel='noopener';}
              div.appendChild(a);
            });
            card.appendChild(div);
          }
          cards.appendChild(card);
        }
      }catch(e){
        document.getElementById('cards').textContent="Failed to load CSV.";
        console.error(e);
      }
    })();
  </script>
</body>
</html>
